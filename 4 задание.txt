#include <iostream>
#include <time.h>

using namespace std;

const int len1 = 10;

int main() {
    int len2{};
    char board[len1][len1]{};
    bool flip[len1][len1]{};
    int flip_q{};
    int cards{};
    int same{};
    int turn_q{};

    cout << "Enter board size from 2 to " << len1 << ": ";
    cin >> len2;

    if (len2 < 2 || len2 > len1) {
        cout << "Invalid board size" << endl;
        return 0;
    }

    cards = len2 * len2;

    for (int i = 0; i < len2; ++i) {
        for (int j = 0; j < len2; ++j) {
            board[i][j] = ' ';
            flip[i][j] = false;
        }
    }

    srand(time(0));
    char current = 'A';

    for (int i = 0; i < cards / 2; ++i) {
        for (int j = 0; j < 2; ++j) {
            int row, col;

            do {
                row = rand() % len2;
                col = rand() % len2;
            } while (board[row][col] != ' ');

            board[row][col] = current;
        }

        ++current;
    }

    int start = time(0);

    while (same < cards / 2) {
        cout << "  ";
        for (int j = 0; j < len2; ++j) {
            cout << j + 1 << ' ';
        }
        cout << endl;

        for (int i = 0; i < len2; ++i) {
            cout << i + 1 << ' ';
            for (int j = 0; j < len2; ++j) {
                if (flip[i][j]) {
                    cout << board[i][j] << ' ';
                } else {
                    cout << "# ";
                }
            }
            cout << endl;
        }

        int row{}, col{};
        char row2[100]{}, col2[100]{};

        while (true) {
            cout << "Enter row: ";
            cin >> row2;

            bool num = true;
            for (int i = 0; row2[i] != '\0'; i++) {
                if (row2[i] < '0' || row2[i] > '9') {
                    num = false;
                    break;
                }
            }

            if (!num) {
                cout << "Invalid input"<< endl;
                continue;
            }

            row = 0;
            for (int i = 0; row2[i] != '\0'; i++) {
                row = row * 10 + (row2[i] - '0');
            }

            if (row < 1 || row > len2) {
                cout << "Invalid input"<< endl;
                continue;
            }

            break;
        }

        while (true) {
            cout << "Enter column: ";
            cin >> col2;

            bool num2 = true;
            for (int i = 0; col2[i] != '\0'; i++) {
                if (col2[i] < '0' || col2[i] > '9') {
                    num2 = false;
                    break;
                }
            }

            if (!num2) {
                cout << "Invalid input" << endl;
                continue;
            }

            col = 0;
            for (int i = 0; col2[i] != '\0'; i++) {
                col = col * 10 + (col2[i] - '0');
            }

            if (col < 1 || col > len2) {
                cout << "Invalid input"<< endl;
                continue;
            }

            break;
        }

        --row;
        --col;

        if (flip[row][col]) {
            cout << "The chosen card is already flipped.Try again" << endl;
            continue;
        }

        flip[row][col] = true;
        ++flip_q;

        cout << "Flipped card: " << board[row][col] << endl;

        if (flip_q == 2) {
            ++turn_q;
            int card_row = -1, card_col = -1;

            for (int i = 0; i < len2; ++i) {
                for (int j = 0; j < len2; ++j) {
                    if (flip[i][j]) {
                        if (card_row == -1 && card_col == -1) {
                            card_row = i;
                            card_col = j;
                        } else {
                            if (board[i][j] == board[card_row][card_col]) {
                                cout << "Pair found" << endl;
                                flip[i][j] = true;
                                ++same;
                            } else {
                                cout << "Pair not found.Cards flipped back" << endl;
                                flip[i][j] = false;
                                flip[card_row][card_col] = false;
                            }

                            flip_q = 0;
                            break;
                        }
                    }
                }

                if (flip_q == 0) {
                    break;
                }
            }
        }

        cout << endl;
    }

    int stop = time(0);

    cout << "You found all the card pairs" << endl;
    cout << "Number of card flips: " << turn_q << endl;
    int game_time = stop - start;
    cout << "Game time: " << game_time << " seconds" << endl;

    return 0;
}
